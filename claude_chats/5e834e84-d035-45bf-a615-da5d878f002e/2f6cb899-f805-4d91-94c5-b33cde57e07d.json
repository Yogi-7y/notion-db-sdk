{
  "uuid": "2f6cb899-f805-4d91-94c5-b33cde57e07d",
  "text": " The error you're seeing suggests that the `call` method on `MockApiClient` is returning `null` instead of a `Future<Result<Map<String, Object?>, ApiException>>`. This is likely because the mock setup is not correctly configured.\n\nLet's modify the test to ensure the mock is set up correctly:\n\n1. First, make sure you're using the latest version of `mocktail`.\n\n2. Update the `when` setup to explicitly return a `Future`:\n\n```dart\nwhen(\n  () => mockApiClient.call<Map<String, Object?>>(any()),\n).thenAnswer((_) async => _success);\n```\n\n3. Ensure that the `ApiClient` class has the correct method signature:\n\n```dart\nclass ApiClient {\n  Future<Result<Map<String, Object?>, ApiException>> call<T>(BaseRequest request);\n}\n```\n\n4. Update the `MockApiClient` class to include the generic type:\n\n```dart\nclass MockApiClient extends Mock implements ApiClient {\n  @override\n  Future<Result<Map<String, Object?>, ApiException>> call<T>(BaseRequest request) {\n    return super.noSuchMethod(\n      Invocation.method(#call, [request]),\n      returnValue: Future.value(Success(<String, Object?>{})),\n    ) as Future<Result<Map<String, Object?>, ApiException>>;\n  }\n}\n```\n\n5. Make sure you're calling the correct method on the repository:\n\n```dart\nfinal _result = await repository.getPageProperties('');\n```\n\nHere's the updated test case:\n\n```dart\nvoid main() {\n  late MockApiClient mockApiClient;\n  late NotionRepository repository;\n\n  setUpAll(() {\n    registerFallbackValue(FakePostRequest());\n  });\n\n  setUp(() {\n    mockApiClient = MockApiClient();\n    repository = NotionRepository(mockApiClient);\n  });\n\n  group('NotionRepository', () {\n    test('return the map of properties when response is successful', () async {\n      final _success = Success<Map<String, Object?>, ApiException>(_payload);\n\n      when(\n        () => mockApiClient.call<Map<String, Object?>>(any()),\n      ).thenAnswer((_) async => _success);\n\n      final _expectedResult = <Map<String, Property<Object?>>>[\n        <String, Property<Object?>>{\n          'Description': const Text(\n            name: 'Description',\n            type: 'rich_text',\n            id: 'a%7BUf',\n            valueDetails: Value(value: 'A dark sky'),\n          ),\n          'Number': const Number(\n            name: 'Number',\n            type: 'number',\n            id: 'uCG%3A',\n            valueDetails: Value(value: 42),\n          ),\n        },\n        {\n          'Number': const Number(\n            name: 'Number',\n            type: 'number',\n            id: 'uCG%3A',\n            valueDetails: Value(value: 42),\n          ),\n          'Date': Date(\n            name: 'Date',\n            type: 'date',\n            id: '%5E%7Cny',\n            valueDetails: Value(\n              value: DateTime(2023, 2, 23),\n            ),\n          ),\n        },\n      ];\n\n      final _result = await repository.getPageProperties('');\n\n      expect(_result, isA<Success<List<Map<String, Property<Object?>>>, ApiException>>());\n      expect(_result.valueOrNull, _expectedResult);\n    });\n  });\n}\n```\n\nThese changes should resolve the `Null` error you're encountering. If you're still having issues, please provide more details about your `ApiClient`, `NotionRepository`, and `BaseRequest` implementations.",
  "sender": "assistant",
  "index": 1,
  "created_at": "2024-08-03T07:28:36.356615+00:00",
  "updated_at": "2024-08-03T07:28:36.356615+00:00",
  "truncated": false,
  "attachments": [],
  "files": [],
  "parent_message_uuid": "87e82f19-b023-49e5-8ab6-33f5e4b14daa"
}